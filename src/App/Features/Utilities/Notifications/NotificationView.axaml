<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="Misa.Ui.Avalonia.Features.Utilities.Notifications.NotificationView"
             Width="500" MinWidth="200" MaxWidth="600"
             xmlns:converters1="clr-namespace:Misa.Ui.Avalonia.Common.Converters"
             xmlns:notifications1="clr-namespace:Misa.Ui.Avalonia.Features.Utilities.Notifications"
             x:DataType="notifications1:NotificationViewModel">

  <Border>

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*,Auto,Auto">

      <!-- Header -->
      <TextBlock Grid.Row="0" Grid.Column="0"
                 Text="Notifications"/>

      <Button Grid.Row="0" Grid.Column="1"
              ToolTip.Tip="Mark all read"
              Command="{Binding MarkAllReadCommand}">
        <TextBlock Text="✓"/>
      </Button>

      <Button Grid.Row="0" Grid.Column="2"
              ToolTip.Tip="Clear"
              Command="{Binding ClearCommand}">
        <TextBlock Text="✕"/>
      </Button>

      <!-- List -->
      <ScrollViewer Grid.Column="0"
                    Grid.Row="1"
                    Grid.ColumnSpan="3">

        <ItemsControl ItemsSource="{Binding Notifications}">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="notifications1:NotificationItem">

              <Border x:Name="Card">

                <Grid ColumnDefinitions="Auto,*,Auto"
                      RowDefinitions="Auto,Auto">

                  <!-- Severity badge -->
                  <Border Grid.RowSpan="2">
                    <TextBlock Text="{Binding SeverityToString}" />
                  </Border>

                  <!-- Message -->
                  <TextBlock Grid.Column="1"
                             Grid.Row="0"
                             Text="{Binding Payload}" />

                  <!-- Dismiss -->
                  <Button Grid.Column="2"
                          Grid.Row="0"
                          ToolTip.Tip="Dismiss"
                          Command="{Binding $parent[notifications1:NotificationViewModel].DismissCommand}"
                          CommandParameter="{Binding Id}">
                    <TextBlock Text="×"
                               FontSize="16" />
                  </Button>

                  <!-- Meta row -->
                  <Grid Grid.Column="1"
                        Grid.Row="1"
                        ColumnDefinitions="*,Auto">

                    <!-- Timestamp + read -->
                    <StackPanel Orientation="Horizontal">
                      <TextBlock Text="{Binding Timestamp}"/>
                      <TextBlock Text="Unread"
                                 IsVisible="{Binding IsRead,
                                   Converter={x:Static converters1:BooleanNotConverter.Instance}}" />
                    </StackPanel>

                    <!-- Notification type -->
                    <TextBlock Grid.Column="1"
                               Text="{Binding TypeToString}" />
                  </Grid>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>
  </Border>
</UserControl>
