<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Misa.Ui.Avalonia.Features.Common.Deadline"
             x:Class="Misa.Ui.Avalonia.Features.Common.Deadline.DeadlineSectionView"
             x:DataType="vm:DeadlineSectionViewModel">

  <Border>
    <StackPanel>

      <!-- Header row -->
      <Grid ColumnDefinitions="*,Auto"
            ColumnSpacing="12">

        <StackPanel>
          <TextBlock Text="Deadline"/>

          <TextBlock Text="{Binding DeadlineText}"
                     IsVisible="{Binding HasDeadline}"
                     TextWrapping="Wrap"/>

          <TextBlock Text="Not set"
                     IsVisible="{Binding !HasDeadline}"/>
        </StackPanel>

        <!-- Icon actions -->
        <StackPanel Grid.Column="1">

          <!-- Set/Edit (Primary) -->
          <Button Command="{Binding ToggleEditCommand}">

            <StackPanel Orientation="Horizontal" Spacing="0">
              <!-- Add -->
              <Image Width="16"
                     Height="16"
                     Source="{SvgImage /Assets/Icons/Shell/Navigation/plus-circle.svg}"
                     IsVisible="{Binding ShowAddIcon}" />
            
              <!-- Edit -->
              <Image Width="16"
                     Height="16"
                     Source="{SvgImage /Assets/Icons/Common/edit.svg}"
                     IsVisible="{Binding ShowEditIcon}" />
            
              <!-- Cancel -->
              <Image Width="16"
                     Height="16"
                     Source="{SvgImage /Assets/Icons/Common/cancel.svg}"
                     IsVisible="{Binding IsEditOpen}" />
            </StackPanel>

          </Button>

          <!-- Delete only if exists -->
          <Button ToolTip.Tip="Delete"
                  Command="{Binding DeleteCommand}"
                  IsVisible="{Binding HasDeadline}">
              <Image Width="16"
                     Height="16"
                     Source="{SvgImage /Assets/Icons/Common/trash.svg}" />
          </Button>

        </StackPanel>
      </Grid>

      <!-- Inline editor: divider + content, no extra border -->
      <Border IsVisible="{Binding IsEditOpen}"/>

      <StackPanel IsVisible="{Binding IsEditOpen}">

        <ContentControl Content="{Binding Input}"/>

        <StackPanel>

          <Button Content="Save"
                  Command="{Binding SaveCommand}" />

          <Button Content="Cancel"
                  Command="{Binding ToggleEditCommand}" />
        </StackPanel>

      </StackPanel>

    </StackPanel>
  </Border>
</UserControl>
