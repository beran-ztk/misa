<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Misa.Ui.Avalonia.Features.Inspector.Information.Extensions.Descriptions.DescriptionView"
             xmlns:descriptions1="clr-namespace:Misa.Ui.Avalonia.Features.Inspector.Information.Extensions.Descriptions"
             x:DataType="descriptions1:DescriptionViewModel">

    <UserControl.Styles>

        <!-- Light chat container -->
        <Style Selector="Border.misa-chat-card">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackgroundLighter}"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Margin" Value="10"/>
        </Style>

        <Style Selector="TextBlock.misa-chat-title">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <!-- Chat bubble -->
        <Style Selector="Border.misa-bubble">
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="MaxWidth" Value="560"/>
        </Style>

        <Style Selector="Border.misa-bubble-left">
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackground}"/>
        </Style>

        <!-- Tiny meta line -->
        <Style Selector="TextBlock.misa-bubble-meta">
            <Setter Property="Opacity" Value="0.55"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,6,0,0"/>
        </Style>

        <!-- Hover actions: subtle -->
        <Style Selector="StackPanel.misa-bubble-actions">
            <Setter Property="Opacity" Value="0.45"/>
            <Setter Property="Spacing" Value="6"/>
            <Setter Property="Orientation" Value="Horizontal"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>

        <!-- Composer -->
        <Style Selector="Border.misa-composer">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackground}"/>
            <Setter Property="Padding" Value="10"/>
        </Style>

        <Style Selector="TextBox.misa-chat-input">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="2"/>
        </Style>

        <Style Selector="Button.misa-send">
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackgroundLighter}"/>
        </Style>

    </UserControl.Styles>

    <Border Classes="misa-chat-card">
        <StackPanel Spacing="12">

            <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
                <TextBlock Grid.Column="0"
                           Text="{Binding Descriptions.Count, StringFormat='Descriptions ({0})'}"
                           Classes="misa-chat-title"/>

                <!-- Optional: small hint / placeholder space for future filter -->
                <TextBlock Grid.Column="1"
                           Text=""
                           Opacity="0.0"/>
            </Grid>

            <!-- Messages -->
            <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Descriptions}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="descriptions1:DescriptionItemViewModel">
                            <Grid Margin="0,0,0,10" ColumnDefinitions="*,Auto">
                                <!-- Bubble -->
                                <Border Grid.Column="0"
                                        Classes="misa-bubble misa-bubble-left">
                                    <StackPanel Spacing="6">
                                        <!-- Read -->
                                        <TextBlock Text="{Binding Content}"
                                                   FontSize="13"
                                                   TextWrapping="Wrap"
                                                   IsVisible="{Binding !IsEditOpen}" />

                                        <!-- Edit -->
                                        <TextBox Text="{Binding EditText, Mode=TwoWay}"
                                                 Classes="misa-input"
                                                 Watermark="Description..."
                                                 TextWrapping="Wrap"
                                                 IsVisible="{Binding IsEditOpen}" />

                                        <TextBlock Text="{Binding CreatedAtUtc, StringFormat={}{0:yyyy-MM-dd HH:mm}}"
                                                   Classes="misa-bubble-meta"
                                                   HorizontalAlignment="Right"/>
                                    </StackPanel>
                                </Border>

                                <!-- Actions (top-right, subtle) -->
                                <StackPanel Grid.Column="1"
                                            Margin="8,0,0,0"
                                            Classes="misa-bubble-actions">

                                    <Button Classes="misa-icon-button"
                                            Command="{Binding ToggleEditCommand}"
                                            ToolTip.Tip="{Binding ToggleEditToolTip}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Width="16" Height="16"
                                                   Source="{SvgImage /Assets/Icons/Common/edit.svg}"
                                                   IsVisible="{Binding !IsEditOpen}" />
                                            <Image Width="16" Height="16"
                                                   Source="{SvgImage /Assets/Icons/Common/cancel.svg}"
                                                   IsVisible="{Binding IsEditOpen}" />
                                        </StackPanel>
                                    </Button>

                                    <Button Classes="misa-icon-button"
                                            Command="{Binding SaveCommand}"
                                            IsEnabled="{Binding CanSave}"
                                            IsVisible="{Binding IsEditOpen}"
                                            ToolTip.Tip="Save">
                                        <Image Width="16" Height="16"
                                               Source="{SvgImage /Assets/Icons/Common/check.svg}" />
                                    </Button>

                                    <Button Classes="misa-icon-button"
                                            Command="{Binding DeleteCommand}"
                                            ToolTip.Tip="Delete">
                                        <Image Width="16" Height="16"
                                               Source="{SvgImage /Assets/Icons/Common/trash.svg}" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Composer -->
            <Border Classes="misa-composer">
                <Grid ColumnDefinitions="*,Auto"
                      ColumnSpacing="10"
                      VerticalAlignment="Center">

                    <TextBox Grid.Column="0"
                             Classes="misa-chat-input"
                             Watermark="Write a description…"
                             Foreground="{StaticResource BrushTextPrimary}"
                             Text="{Binding Description, Mode=TwoWay}" />

                    <Button Grid.Column="1"
                            Classes="misa-send"
                            Command="{Binding AddDescriptionCommand}"
                            IsEnabled="{Binding IsDescriptionValid}"
                            ToolTip.Tip="Add">
                        <Image Width="16"
                               Height="16"
                               Source="{SvgImage /Assets/Icons/Shell/Navigation/plus-circle.svg}" />
                    </Button>
                </Grid>
            </Border>

        </StackPanel>
    </Border>

</UserControl>
