<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="Misa.Ui.Avalonia.Features.Inspector.Tabs.Entry.Extensions.Sessions.CurrentSessionView"
             xmlns:root="clr-namespace:Misa.Ui.Avalonia.Features.Inspector.Tabs.Entry.Base"
             x:DataType="root:InspectorEntryViewModel">

    <UserControl.Styles>
        <!-- Small, modern “card” language without touching logic/bindings -->
        <Style Selector="Border.session-card">
            <Setter Property="Padding" Value="12"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackgroundLighter}"/>
        </Style>

        <Style Selector="TextBlock.session-title">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,2,0,6"/>
        </Style>

        <Style Selector="TextBlock.session-label">
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style Selector="TextBlock.session-value-strong">
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style Selector="StackPanel.session-actions">
            <Setter Property="Spacing" Value="8"/>
        </Style>

        <Style Selector="Button.session-icon">
            <Setter Property="Width" Value="34"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style Selector="Border.session-subcard">
            <Setter Property="Padding" Value="10"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackgroundLighter}"/>
        </Style>

        <Style Selector="Border.session-pill">
            <Setter Property="CornerRadius" Value="999"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BrushBorder}"/>
            <Setter Property="Background" Value="{StaticResource BrushPrimaryBackgroundLighter}"/>
        </Style>

        <Style Selector="TextBlock.session-muted">
            <Setter Property="Opacity" Value="0.7"/>
        </Style>

        <Style Selector="StackPanel.session-form-buttons">
            <Setter Property="Spacing" Value="8"/>
        </Style>
    </UserControl.Styles>

    <StackPanel Spacing="12">

        <Border Classes="session-card"
                Margin="10">

            <StackPanel Spacing="12">

                <StackPanel Spacing="10">

                    <TextBlock Classes="session-title"
                               Text="Current session"/>

                    <!-- Current session card -->
                    <Border Classes="session-subcard">
                        <StackPanel>

                            <!-- Active session content -->
                            <Border IsVisible="{Binding HasActiveSession}">
                                <Grid ColumnDefinitions="Auto,*,Auto"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto"
                                      RowSpacing="8"
                                      ColumnSpacing="12"
                                      DataContext="{Binding CurrentSession.ActiveSession}">

                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Classes="session-label"
                                               Text="State"/>
                                    <Border Grid.Row="0" Grid.Column="1"
                                            Classes="session-pill">
                                        <TextBlock Text="{Binding State}"
                                                   Classes="session-value-strong"/>
                                    </Border>

                                    <Border Grid.Row="0" Grid.Column="2"
                                            Classes="session-pill"
                                            HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding ElapsedTime}"
                                                   Classes="session-value-strong"/>
                                    </Border>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                               Classes="session-label"
                                               Text="Objective"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1"
                                               Grid.ColumnSpan="2"
                                               Text="{Binding Objective}"
                                               TextWrapping="Wrap"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                               Classes="session-label"
                                               Text="Planned"/>
                                    <StackPanel Grid.Row="2" Grid.Column="1"
                                                Grid.ColumnSpan="2"
                                                Orientation="Horizontal"
                                                Spacing="8">
                                        <TextBlock Text="{Binding PlannedDuration}"/>
                                        <Border Classes="session-pill"
                                                IsVisible="{Binding StopAutomatically}">
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <TextBlock Text="auto stop"/>
                                                <TextBlock Text="{Binding AutoStopReason}"
                                                           Classes="session-muted"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <TextBlock Grid.Row="3" Grid.Column="0"
                                               Classes="session-label"
                                               Text="Created"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1"
                                               Grid.ColumnSpan="2"
                                               Text="{Binding CreatedAtUtc}"/>

                                    <TextBlock Grid.Row="4" Grid.Column="0"
                                               Classes="session-label"
                                               Text="Segments"/>

                                    <ItemsControl Grid.Row="4" Grid.Column="1"
                                                  Grid.ColumnSpan="2"
                                                  ItemsSource="{Binding Segments}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Classes="session-subcard"
                                                        Margin="0,0,0,8">
                                                    <Grid ColumnDefinitions="Auto,*,Auto"
                                                          RowDefinitions="Auto,Auto"
                                                          ColumnSpacing="12"
                                                          RowSpacing="6">

                                                        <TextBlock Grid.Row="0" Grid.Column="0"
                                                                   Classes="session-label"
                                                                   Text="Start"/>
                                                        <TextBlock Grid.Row="0" Grid.Column="1"
                                                                   Text="{Binding StartedAtUtc}"/>

                                                        <TextBlock Grid.Row="1" Grid.Column="0"
                                                                   Classes="session-label"
                                                                   Text="End"/>
                                                        <TextBlock Grid.Row="1" Grid.Column="1"
                                                                   Text="{Binding EndedAtUtc}"/>

                                                        <TextBlock Grid.Row="0" Grid.Column="2"
                                                                   Grid.RowSpan="2"
                                                                   Text="{Binding PauseReason}"
                                                                   Classes="session-muted"
                                                                   TextWrapping="Wrap"
                                                                   HorizontalAlignment="Right"
                                                                   VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                </Grid>
                            </Border>

                            <!-- Current empty state -->
                            <Border IsVisible="{Binding !HasActiveSession}">
                                <TextBlock Text="No active session."
                                           Classes="session-muted"/>
                            </Border>

                        </StackPanel>
                    </Border>

                </StackPanel>

            </StackPanel>

        </Border>
        
        <!-- Pause-Session Form -->
        <Border Classes="session-card"
                Margin="10,0,10,10"
                IsVisible="{Binding IsPauseSessionFormOpen}">

            <StackPanel Spacing="10">
                <TextBlock Classes="session-title"
                           Text="Pause session"/>

                <Grid ColumnDefinitions="*"
                      RowDefinitions="Auto,Auto"
                      RowSpacing="10">

                    <TextBlock Grid.Row="0"
                               Classes="session-muted"
                               Text="What is the reason to pause your session?" />

                    <StackPanel Grid.Row="1" Spacing="8">
                        <TextBox Classes="misa-input"
                                 Text="{Binding PauseReason, Mode=TwoWay}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MinHeight="90"/>

                        <StackPanel Orientation="Horizontal"
                                    Classes="session-form-buttons"
                                    HorizontalAlignment="Right">
                            <Button Command="{Binding ClosePauseSessionFormCommand}"
                                    Content="Cancel"/>
                            <Button Content="Save"
                                    Command="{Binding PauseSessionCommand}" />
                        </StackPanel>
                    </StackPanel>

                </Grid>
            </StackPanel>
        </Border>


        <!-- Stop-Session Form -->
        <Border Classes="session-card"
                Margin="10,0,10,10"
                IsVisible="{Binding IsStopSessionFormOpen}">

            <StackPanel Spacing="10">
                <TextBlock Classes="session-title"
                           Text="Stop session"/>

                <Grid ColumnDefinitions="140,*"
                      RowDefinitions="Auto,Auto,Auto"
                      RowSpacing="10"
                      ColumnSpacing="10">

                    <TextBlock Grid.Row="0" Grid.Column="0"
                               Classes="session-label"
                               Text="Efficiency" />
                    <ComboBox Grid.Row="0" Grid.Column="1"
                              Classes="misa-input"
                              ItemsSource="{Binding Efficiencies}"
                              SelectedItem="{Binding SelectedEfficiency}"/>

                    <TextBlock Grid.Row="1" Grid.Column="0"
                               Classes="session-label"
                               Text="Concentration" />
                    <ComboBox Grid.Row="1" Grid.Column="1"
                              Classes="misa-input"
                              ItemsSource="{Binding Concentrations}"
                              SelectedItem="{Binding SelectedConcentration}"/>

                    <TextBlock Grid.Row="2" Grid.Column="0"
                               Classes="session-label"
                               Text="Summary" />

                    <StackPanel Grid.Row="2" Grid.Column="1" Spacing="8">
                        <TextBox Classes="misa-input"
                                 Text="{Binding Summary, Mode=TwoWay}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MinHeight="90"
                                 Watermark="What happened? Short summary." />

                        <StackPanel Orientation="Horizontal"
                                    Classes="session-form-buttons"
                                    HorizontalAlignment="Right">
                            <Button Content="Cancel"
                                    Command="{Binding CloseStopSessionFormCommand}"/>
                            <Button Content="Save"
                                    Command="{Binding StopSessionCommand}" />
                        </StackPanel>
                    </StackPanel>

                </Grid>
            </StackPanel>
        </Border>

    </StackPanel>
</UserControl>
