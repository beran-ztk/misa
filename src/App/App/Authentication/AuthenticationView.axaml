<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="Misa.Ui.Avalonia.App.Authentication.AuthenticationView"
             xmlns:vm="clr-namespace:Misa.Ui.Avalonia.App.Authentication"
             x:DataType="vm:AuthenticationViewModel">

    <!-- Full-screen "auth screen" background, not black -->
    <Grid Background="{StaticResource BrushPrimaryBackgroundLighter}">

        <!-- Centered surface (no harsh border look; rely on background contrast) -->
        <Border Background="{StaticResource BrushPrimaryBackgroundLight}"
                CornerRadius="10"
                Padding="30"
                Width="520"
                MaxWidth="640"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">

            <StackPanel Spacing="14">

                <!-- Header -->
                <StackPanel Spacing="4">
                    <TextBlock Text="MISA"
                               FontSize="{StaticResource FontSizeLarge}"
                               Foreground="{StaticResource BrushTextFaded}"
                               Margin="0"/>

                    <TextBlock Text="{Binding SubtitleText}"
                               Classes="misa-subtitle"
                               Margin="0"/>
                </StackPanel>

                <!-- subtle separator -->
                <Border Height="1"
                        Background="{StaticResource BrushBorder}"
                        Opacity="0.35"/>

                

                <!-- Form -->
                <StackPanel Spacing="10">

                    <StackPanel Spacing="6">
                        <TextBlock Text="Username" Classes="misa-label" Margin="0"/>
                        <TextBox Text="{Binding Username, Mode=TwoWay}"
                                 Classes="misa-input"
                                 IsEnabled="{Binding IsNotBusy}"/>
                    </StackPanel>

                    <StackPanel Spacing="6">
                        <TextBlock Text="Password" Classes="misa-label" Margin="0"/>
                        <TextBox Text="{Binding Password, Mode=TwoWay}"
                                 Classes="misa-input"
                                 PasswordChar="•"
                                 IsEnabled="{Binding IsNotBusy}"/>
                    </StackPanel>

                    <StackPanel IsVisible="{Binding IsRegisterMode}"
                                Spacing="10">

                        <StackPanel Spacing="6">
                            <TextBlock Text="Confirm password" Classes="misa-label" Margin="0"/>
                            <TextBox Text="{Binding ConfirmPassword, Mode=TwoWay}"
                                     Classes="misa-input"
                                     PasswordChar="•"
                                     Watermark="Repeat password"
                                     IsEnabled="{Binding IsNotBusy}"/>
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="Time zone" Classes="misa-label" Margin="0"/>
                            <ComboBox ItemsSource="{Binding TimeZoneIds}"
                                      SelectedItem="{Binding SelectedTimeZoneId, Mode=TwoWay}"
                                      Classes="misa-input"
                                      IsEnabled="{Binding IsNotBusy}"
                                      Height="38"
                                      HorizontalAlignment="Stretch"/>
                        </StackPanel>

                    </StackPanel>

                </StackPanel>

                <!-- Error banner -->
                <Border Classes="misa-error-banner"
                        IsVisible="{Binding HasError}">
                    <TextBlock Text="{Binding ErrorMessage}"
                               Foreground="{StaticResource BrushError}"
                               TextWrapping="Wrap"/>
                </Border>
                
                <!-- Mode switch (modern auth pattern) -->
                <StackPanel Spacing="6" HorizontalAlignment="Center">

                    <!-- Login mode: show "Create account" -->
                    <StackPanel Orientation="Horizontal"
                                Spacing="6"
                                HorizontalAlignment="Center"
                                IsVisible="{Binding IsLoginMode}">
                        <TextBlock Text="No account?"
                                   Classes="misa-muted"/>
                        <Button Content="Create one"
                                Classes="misa-link"
                                Command="{Binding SetRegisterModeCommand}"/>
                    </StackPanel>

                    <!-- Register mode: show "Back to sign in" -->
                    <StackPanel Orientation="Horizontal"
                                Spacing="6"
                                HorizontalAlignment="Center"
                                IsVisible="{Binding IsRegisterMode}">
                        <TextBlock Text="Already have an account?"
                                   Classes="misa-muted"/>
                        <Button Content="Sign in"
                                Classes="misa-link"
                                Command="{Binding SetLoginModeCommand}"/>
                    </StackPanel>

                </StackPanel>
                
                <!-- Actions: side-by-side, consistent sizing -->
                <Grid ColumnDefinitions="Auto,Auto"
                      ColumnSpacing="10"
                      HorizontalAlignment="Right">

                    <Button Grid.Column="0"
                            Content="Close"
                            Command="{Binding CloseCommand}"
                            IsEnabled="{Binding IsNotBusy}"
                            Classes="misa-secondary"
                            Height="40"
                            VerticalContentAlignment="Center"
                            MinWidth="100"/>

                    <Button Grid.Column="1"
                            Content="{Binding PrimaryButtonText}"
                            Command="{Binding SubmitCommand}"
                            IsEnabled="{Binding CanSubmit}"
                            Classes="misa-primary misa-auth-primary"
                            Height="40"
                            VerticalContentAlignment="Center"
                            MinWidth="100"/>
                </Grid>

            </StackPanel>
        </Border>
    </Grid>
</UserControl>
